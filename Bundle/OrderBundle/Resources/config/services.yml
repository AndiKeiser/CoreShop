imports:
  - { resource: "services/cart-price-rules.yml" }

parameters:
  coreshop.folder.cart: /%coreshop.folder.objects%/cart
  coreshop.folder.order: /%coreshop.folder.objects%/order
  coreshop.folder.order_item: items

services:
  coreshop.order.configurator.session_cart:
    class: CoreShop\Bundle\OrderBundle\Session\SessionCartConfigurator
    tags:
        - { name: pimcore.session.configurator }

  coreshop.cart.manager:
    class: CoreShop\Bundle\OrderBundle\Manager\CartManager
    arguments:
      - '@coreshop.repository.cart'
      - '@coreshop.factory.cart'
      - '@session'
      - '@coreshop.core.object_service'
      - '@security.token_storage'
      - '%coreshop.folder.cart%'

  #Cart Discount Calculator
  coreshop.cart.discount_calculator.price_rules:
    class: CoreShop\Bundle\OrderBundle\Cart\Calculator\CartPriceRuleCalculator
    arguments:
      - '@coreshop.registry.cart_price_rule.actions'
      - '@coreshop.cart_price_rule.rule_validation.processor'

  coreshop.cart.discount_calculator.composite:
    class: CoreShop\Bundle\ProductBundle\Calculator\CompositePriceCalculator
    arguments: [['@coreshop.cart.discount_calculator.price_rules']]

  coreshop.cart.discount_calculator:
    alias: coreshop.cart.discount_calculator.composite

  coreshop.cart.modifier:
    class: CoreShop\Component\Order\Cart\CartModifier
    arguments: ['@coreshop.cart.manager', '@coreshop.factory.cart_item']